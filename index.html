<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‡ ä½•å›¾å½¢æ¶‚è‰² - å‡å‹æ¶‚é¸¦æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "å¾®è½¯é›…é»‘", sans-serif;
        }

        body {
            background-color: #f5f7fa;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
        }

        .game-container {
            max-width: 900px;
            width: 100%;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            padding: 25px;
        }

        .title {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 32px;
        }

        /* è®¡æ—¶å™¨æ ·å¼ */
        .timer {
            text-align: center;
            font-size: 20px;
            color: #e74c3c;
            margin-bottom: 15px;
            font-weight: bold;
        }

        /* å›¾å½¢é€‰æ‹©å™¨æ ·å¼ */
        .shape-selector {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .shape-btn {
            padding: 8px 14px;
            background-color: #ffffff;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .shape-btn.active {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }

        .shape-btn:hover {
            background-color: #e8f4fd;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        /* é¢œè‰²é€‰æ‹©å™¨æ ·å¼ */
        .color-palette {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            max-width: 600px;
        }

        .color-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .color-btn:hover {
            transform: scale(1.1);
        }

        .color-btn.active {
            outline: 3px solid #333;
            outline-offset: 2px;
        }

        /* å·¥å…·æŒ‰é’®ç»„ */
        .tool-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .eraser-btn, .restart-btn {
            padding: 8px 18px;
            background-color: #95a5a6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        .eraser-btn.active {
            background-color: #7f8c8d;
        }

        .eraser-btn:hover {
            background-color: #8e9e9f;
        }

        .restart-btn {
            background-color: #e74c3c;
        }

        .restart-btn:hover {
            background-color: #c0392b;
        }

        .brush-size {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .brush-size label {
            font-size: 14px;
            color: #666;
        }

        .brush-size input {
            width: 80px;
        }

        .canvas-container {
            width: 100%;
            height: 550px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            background-color: #fff;
            margin-bottom: 15px;
        }

        #coloringCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }

        .hint {
            text-align: center;
            color: #666;
            font-size: 14px;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .modal h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 24px;
        }

        .modal p {
            color: #666;
            margin-bottom: 25px;
            font-size: 16px;
        }

        .modal-btn {
            padding: 10px 25px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.2s;
        }

        .modal-btn:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1 class="title">å‡ ä½•å›¾å½¢æ¶‚è‰² ğŸ¨</h1>
        
        <!-- è®¡æ—¶å™¨ -->
        <div class="timer" id="timer">å‰©ä½™æ—¶é—´ï¼š05:00</div>
        
        <!-- å›¾å½¢é€‰æ‹©å™¨ -->
        <div class="shape-selector">
            <!-- ä¸‰è§’å½¢ç³»åˆ— -->
            <button class="shape-btn active" data-shape="triangle1">ä¸‰è§’å½¢1</button>
            <button class="shape-btn" data-shape="triangle2">ä¸‰è§’å½¢2</button>
            <button class="shape-btn" data-shape="triangle3">ä¸‰è§’å½¢3</button>
            <button class="shape-btn" data-shape="triangle4">ä¸‰è§’å½¢4</button>
            <button class="shape-btn" data-shape="triangle5">ä¸‰è§’å½¢5</button>
            
            <!-- æ­£æ–¹å½¢ç³»åˆ— -->
            <button class="shape-btn" data-shape="square">æ­£æ–¹å½¢</button>
            <button class="shape-btn" data-shape="square1">æ­£æ–¹å½¢1</button>
            <button class="shape-btn" data-shape="square2">æ­£æ–¹å½¢2</button>
            
            <!-- å…­è¾¹å½¢ç³»åˆ— -->
            <button class="shape-btn" data-shape="hexagon1">å…­è¾¹å½¢1</button>
            <button class="shape-btn" data-shape="hexagon2">å…­è¾¹å½¢2</button>
            <button class="shape-btn" data-shape="hexagon3">å…­è¾¹å½¢3</button>
        </div>

        <div class="controls">
            <div class="color-palette">
                <!-- é¢œè‰²é¢æ¿ -->
                <button class="color-btn active" style="background-color: #ffffff;"></button>
                <button class="color-btn" style="background-color: #e74c3c;"></button>
                <button class="color-btn" style="background-color: #3498db;"></button>
                <button class="color-btn" style="background-color: #2ecc71;"></button>
                <button class="color-btn" style="background-color: #f1c40f;"></button>
                <button class="color-btn" style="background-color: #9b59b6;"></button>
                <button class="color-btn" style="background-color: #e67e22;"></button>
                <button class="color-btn" style="background-color: #1abc9c;"></button>
                <button class="color-btn" style="background-color: #34495e;"></button>
                <button class="color-btn" style="background-color: #f39c12;"></button>
                <button class="color-btn" style="background-color: #8e44ad;"></button>
                <button class="color-btn" style="background-color: #c0392b;"></button>
            </div>

            <!-- å·¥å…·æŒ‰é’®ç»„ -->
            <div class="tool-group">
                <div class="brush-size">
                    <label>ç”»ç¬”å¤§å°ï¼š</label>
                    <input type="range" id="brushSize" min="5" max="25" value="10">
                </div>
                <button class="eraser-btn" id="eraserBtn">æ©¡çš®æ“¦</button>
                <button class="restart-btn" id="restartBtn">é‡æ–°å¼€å§‹</button>
            </div>
        </div>

        <div class="canvas-container">
            <canvas id="coloringCanvas"></canvas>
        </div>

        <p class="hint">é€‰æ‹©å‡ ä½•å›¾å½¢å’Œé¢œè‰²ï¼Œç‚¹å‡»/æ‹–åŠ¨ç”»å¸ƒæ¶‚è‰² | æ©¡çš®æ“¦å¯æ“¦é™¤æ¶‚è‰² | æ¸¸æˆæ—¶é—´ï¼š5åˆ†é’Ÿ</p>
    </div>

    <!-- æ¸¸æˆç»“æŸæ¨¡æ€æ¡† -->
    <div class="modal" id="gameOverModal">
        <div class="modal-content">
            <h2>æ¸¸æˆç»“æŸï¼â°</h2>
            <p>ä½ åœ¨5åˆ†é’Ÿå†…å®Œæˆäº†<span id="completedShapes">0</span>ä¸ªå‡ ä½•å›¾å½¢çš„æ¶‚è‰²</p>
            <button class="modal-btn" id="modalRestartBtn">å†æ¥ä¸€å±€</button>
        </div>
    </div>

    <script>
        // æ ¸å¿ƒå˜é‡
        const canvas = document.getElementById('coloringCanvas');
        const ctx = canvas.getContext('2d');
        const colorButtons = document.querySelectorAll('.color-btn');
        const shapeButtons = document.querySelectorAll('.shape-btn');
        const eraserButton = document.getElementById('eraserBtn');
        const restartButton = document.getElementById('restartBtn');
        const modalRestartButton = document.getElementById('modalRestartBtn');
        const brushSizeInput = document.getElementById('brushSize');
        const timerElement = document.getElementById('timer');
        const gameOverModal = document.getElementById('gameOverModal');
        const completedShapesElement = document.getElementById('completedShapes');

        // æ¸¸æˆçŠ¶æ€å˜é‡
        let selectedColor = '#ffffff';
        let isDrawing = false;
        let isErasing = false;
        let currentShape = 'triangle1';
        let brushSize = 10;
        let timeRemaining = 5 * 60; // 5åˆ†é’Ÿï¼ˆç§’ï¼‰
        let timerInterval;
        let coloredPixels = 0;
        let totalPixels = 0;
        let completedShapes = 0;

        // åˆå§‹åŒ–ç”»å¸ƒå°ºå¯¸
        function initCanvasSize() {
            const container = canvas.parentElement;
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;
            drawCurrentShape();
            calculateTotalPixels();
        }

        // ç»˜åˆ¶å½“å‰é€‰ä¸­çš„å‡ ä½•å›¾å½¢
        function drawCurrentShape() {
            const width = canvas.width;
            const height = canvas.height;
            const centerX = width / 2;
            const centerY = height / 2;
            const size = Math.min(width, height) * 0.4; // å›¾å½¢åŸºç¡€å°ºå¯¸

            // æ¸…ç©ºç”»å¸ƒ
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, width, height);
            ctx.strokeStyle = '#2c3e50';
            ctx.lineWidth = 3;
            ctx.fillStyle = '#2c3e50';
            ctx.font = '16px Arial';

            // æ ¹æ®é€‰ä¸­çš„å›¾å½¢ç»˜åˆ¶ä¸åŒçš„å‡ ä½•å›¾å½¢
            switch (currentShape) {
                // ä¸‰è§’å½¢ç³»åˆ—
                case 'triangle1':
                    drawTriangle1(centerX, centerY, size);
                    break;
                case 'triangle2':
                    drawTriangle2(centerX, centerY, size);
                    break;
                case 'triangle3':
                    drawTriangle3(centerX, centerY, size);
                    break;
                case 'triangle4':
                    drawTriangle4(centerX, centerY, size);
                    break;
                case 'triangle5':
                    drawTriangle5(centerX, centerY, size);
                    break;
                
                // æ­£æ–¹å½¢ç³»åˆ—
                case 'square':
                    drawSquare(centerX, centerY, size);
                    break;
                case 'square1':
                    drawSquare1(centerX, centerY, size);
                    break;
                case 'square2':
                    drawSquare2(centerX, centerY, size);
                    break;
                
                // å…­è¾¹å½¢ç³»åˆ—
                case 'hexagon1':
                    drawHexagon1(centerX, centerY, size);
                    break;
                case 'hexagon2':
                    drawHexagon2(centerX, centerY, size);
                    break;
                case 'hexagon3':
                    drawHexagon3(centerX, centerY, size);
                    break;
            }
        }

        // 1. ä¸‰è§’å½¢ç³»åˆ—ç»˜åˆ¶å‡½æ•°
        // åŸºç¡€ä¸‰è§’å½¢ï¼ˆæ— å†…éƒ¨ç»“æ„ï¼‰
        function drawTriangle1(x, y, size) {
            ctx.beginPath();
            ctx.moveTo(x, y - size);
            ctx.lineTo(x - size * Math.cos(Math.PI/6), y + size * Math.sin(Math.PI/6));
            ctx.lineTo(x + size * Math.cos(Math.PI/6), y + size * Math.sin(Math.PI/6));
            ctx.closePath();
            ctx.stroke();
            ctx.fillText('1', x, y);
        }

        // ä¸‰è§’å½¢ï¼ˆä¸­çº¿åˆ†å‰²ï¼‰
        function drawTriangle2(x, y, size) {
            // å¤–è½®å»“
            ctx.beginPath();
            ctx.moveTo(x, y - size);
            ctx.lineTo(x - size * Math.cos(Math.PI/6), y + size * Math.sin(Math.PI/6));
            ctx.lineTo(x + size * Math.cos(Math.PI/6), y + size * Math.sin(Math.PI/6));
            ctx.closePath();
            ctx.stroke();
            
            // ä¸­çº¿
            ctx.beginPath();
            ctx.moveTo(x, y - size);
            ctx.lineTo(x, y + size * Math.sin(Math.PI/6));
            ctx.stroke();
            
            ctx.fillText('1', x - size/3, y);
            ctx.fillText('2', x + size/3, y);
        }

        // ä¸‰è§’å½¢ï¼ˆè§’å¹³åˆ†çº¿åˆ†å‰²ï¼‰
        function drawTriangle3(x, y, size) {
            // å¤–è½®å»“
            ctx.beginPath();
            ctx.moveTo(x, y - size);
            ctx.lineTo(x - size * Math.cos(Math.PI/6), y + size * Math.sin(Math.PI/6));
            ctx.lineTo(x + size * Math.cos(Math.PI/6), y + size * Math.sin(Math.PI/6));
            ctx.closePath();
            ctx.stroke();
            
            // è§’å¹³åˆ†çº¿
            const centerX = x;
            const centerY = y + size * Math.sin(Math.PI/6) / 3;
            ctx.beginPath();
            ctx.moveTo(x, y - size);
            ctx.lineTo(centerX, centerY);
            ctx.moveTo(x - size * Math.cos(Math.PI/6), y + size * Math.sin(Math.PI/6));
            ctx.lineTo(centerX, centerY);
            ctx.moveTo(x + size * Math.cos(Math.PI/6), y + size * Math.sin(Math.PI/6));
            ctx.lineTo(centerX, centerY);
            ctx.stroke();
            
            ctx.fillText('1', x - size/3, y - size/3);
            ctx.fillText('2', x - size/3, y + size/3);
            ctx.fillText('3', x + size/3, y + size/3);
        }

        // ä¸‰è§’å½¢ï¼ˆå†…åˆ‡åœ†ï¼‰
        function drawTriangle4(x, y, size) {
            // å¤–è½®å»“
            ctx.beginPath();
            ctx.moveTo(x, y - size);
            ctx.lineTo(x - size * Math.cos(Math.PI/6), y + size * Math.sin(Math.PI/6));
            ctx.lineTo(x + size * Math.cos(Math.PI/6), y + size * Math.sin(Math.PI/6));
            ctx.closePath();
            ctx.stroke();
            
            // å†…åˆ‡åœ†
            const inradius = size * Math.sin(Math.PI/6) / 2;
            ctx.beginPath();
            ctx.arc(x, y, inradius, 0, Math.PI * 2);
            ctx.stroke();
            
            ctx.fillText('1', x, y - size/2);
            ctx.fillText('2', x, y);
        }

        // ä¸‰è§’å½¢ï¼ˆç½‘æ ¼ç»“æ„ï¼‰
        function drawTriangle5(x, y, size) {
            // å¤–è½®å»“
            ctx.beginPath();
            ctx.moveTo(x, y - size);
            ctx.lineTo(x - size * Math.cos(Math.PI/6), y + size * Math.sin(Math.PI/6));
            ctx.lineTo(x + size * Math.cos(Math.PI/6), y + size * Math.sin(Math.PI/6));
            ctx.closePath();
            ctx.stroke();
            
            // ç½‘æ ¼çº¿
            for (let i = 1; i < 3; i++) {
                const step = size / 3;
                const yPos = y - size + i * step * 2;
                const width = step * i * Math.cos(Math.PI/6) * 2;
                
                ctx.beginPath();
                ctx.moveTo(x - width/2, yPos);
                ctx.lineTo(x + width/2, yPos);
                ctx.stroke();
            }
            
            ctx.fillText('1', x, y - size/2);
            ctx.fillText('2', x, y);
            ctx.fillText('3', x, y + size/2);
        }

        // 2. æ­£æ–¹å½¢ç³»åˆ—ç»˜åˆ¶å‡½æ•°
        // åŸºç¡€æ­£æ–¹å½¢ï¼ˆæ— å†…éƒ¨ç»“æ„ï¼‰
        function drawSquare(x, y, size) {
            ctx.beginPath();
            ctx.rect(x - size, y - size, size * 2, size * 2);
            ctx.stroke();
            ctx.fillText('1', x, y);
        }

        // æ­£æ–¹å½¢ï¼ˆå¯¹è§’çº¿åˆ†å‰²ï¼‰
        function drawSquare1(x, y, size) {
            // å¤–è½®å»“
            ctx.beginPath();
            ctx.rect(x - size, y - size, size * 2, size * 2);
            ctx.stroke();
            
            // å¯¹è§’çº¿
            ctx.beginPath();
            ctx.moveTo(x - size, y - size);
            ctx.lineTo(x + size, y + size);
            ctx.moveTo(x + size, y - size);
            ctx.lineTo(x - size, y + size);
            ctx.stroke();
            
            ctx.fillText('1', x - size/2, y - size/2);
            ctx.fillText('2', x + size/2, y - size/2);
            ctx.fillText('3', x - size/2, y + size/2);
            ctx.fillText('4', x + size/2, y + size/2);
        }

        // æ­£æ–¹å½¢ï¼ˆä¹å®«æ ¼ï¼‰
        function drawSquare2(x, y, size) {
            // å¤–è½®å»“
            ctx.beginPath();
            ctx.rect(x - size, y - size, size * 2, size * 2);
            ctx.stroke();
            
            // ä¹å®«æ ¼çº¿
            ctx.beginPath();
            ctx.moveTo(x - size/3 * 2, y - size);
            ctx.lineTo(x - size/3 * 2, y + size);
            ctx.moveTo(x + size/3 * 2, y - size);
            ctx.lineTo(x + size/3 * 2, y + size);
            ctx.moveTo(x - size, y - size/3 * 2);
            ctx.lineTo(x + size, y - size/3 * 2);
            ctx.moveTo(x - size, y + size/3 * 2);
            ctx.lineTo(x + size, y + size/3 * 2);
            ctx.stroke();
            
            // æ•°å­—æ ‡è®°
            let count = 1;
            for (let i = -1; i <= 1; i++) {
                for (let j = -1; j <= 1; j++) {
                    ctx.fillText(count++, x + i * size/2, y + j * size/2);
                }
            }
        }

        // 3. å…­è¾¹å½¢ç³»åˆ—ç»˜åˆ¶å‡½æ•°
        // åŸºç¡€å…­è¾¹å½¢ï¼ˆæ— å†…éƒ¨ç»“æ„ï¼‰
        function drawHexagon1(x, y, size) {
            ctx.beginPath();
            for (let i = 0; i < 6; i++) {
                const angle = Math.PI/2 + i * Math.PI/3;
                const px = x + size * Math.cos(angle);
                const py = y + size * Math.sin(angle);
                i === 0 ? ctx.moveTo(px, py) : ctx.lineTo(px, py);
            }
            ctx.closePath();
            ctx.stroke();
            ctx.fillText('1', x, y);
        }

        // å…­è¾¹å½¢ï¼ˆä¸­å¿ƒç‚¹è¾å°„ï¼‰
        function drawHexagon2(x, y, size) {
            // å¤–è½®å»“
            ctx.beginPath();
            for (let i = 0; i < 6; i++) {
                const angle = Math.PI/2 + i * Math.PI/3;
                const px = x + size * Math.cos(angle);
                const py = y + size * Math.sin(angle);
                i === 0 ? ctx.moveTo(px, py) : ctx.lineTo(px, py);
            }
            ctx.closePath();
            ctx.stroke();
            
            // è¾å°„çº¿
            for (let i = 0; i < 6; i++) {
                const angle = Math.PI/2 + i * Math.PI/3;
                const px = x + size * Math.cos(angle);
                const py = y + size * Math.sin(angle);
                ctx.beginPath();
                ctx.moveTo(x, y);
                ctx.lineTo(px, py);
                ctx.stroke();
            }
            
            // æ•°å­—æ ‡è®°
            for (let i = 0; i < 6; i++) {
                const angle = Math.PI/2 + (i + 0.5) * Math.PI/3;
                const px = x + size/2 * Math.cos(angle);
                const py = y + size/2 * Math.sin(angle);
                ctx.fillText(i + 1, px, py);
            }
        }

        // å…­è¾¹å½¢ï¼ˆå†…éƒ¨å…­è¾¹å½¢ï¼‰
        function drawHexagon3(x, y, size) {
            // å¤–è½®å»“
            ctx.beginPath();
            for (let i = 0; i < 6; i++) {
                const angle = Math.PI/2 + i * Math.PI/3;
                const px = x + size * Math.cos(angle);
                const py = y + size * Math.sin(angle);
                i === 0 ? ctx.moveTo(px, py) : ctx.lineTo(px, py);
            }
            ctx.closePath();
            ctx.stroke();
            
            // å†…éƒ¨å…­è¾¹å½¢
            ctx.beginPath();
            for (let i = 0; i < 6; i++) {
                const angle = Math.PI/2 + i * Math.PI/3;
                const px = x + size/2 * Math.cos(angle);
                const py = y + size/2 * Math.sin(angle);
                i === 0 ? ctx.moveTo(px, py) : ctx.lineTo(px, py);
            }
            ctx.closePath();
            ctx.stroke();
            
            // è¿æ¥é¡¶ç‚¹
            for (let i = 0; i < 6; i++) {
                const angle1 = Math.PI/2 + i * Math.PI/3;
                const angle2 = Math.PI/2 + (i + 1) * Math.PI/3;
                
                const px1 = x + size * Math.cos(angle1);
                const py1 = y + size * Math.sin(angle1);
                const px2 = x + size/2 * Math.cos(angle2);
                const py2 = y + size/2 * Math.sin(angle2);
                
                ctx.beginPath();
                ctx.moveTo(px1, py1);
                ctx.lineTo(px2, py2);
                ctx.stroke();
            }
            
            ctx.fillText('1', x, y - size/2);
            ctx.fillText('2', x - size/2, y);
            ctx.fillText('3', x, y + size/2);
            ctx.fillText('4', x + size/2, y);
            ctx.fillText('5', x, y);
        }

        // è®¡ç®—å½“å‰å›¾å½¢çš„æ€»åƒç´ æ•°ï¼ˆç”¨äºç»Ÿè®¡å®Œæˆåº¦ï¼‰
        function calculateTotalPixels() {
            const width = canvas.width;
            const height = canvas.height;
            totalPixels = width * height * 0.3; // ä¼°ç®—å›¾å½¢åŒºåŸŸåƒç´ æ•°
            coloredPixels = 0;
        }

        // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
        function updateTimer() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            timerElement.textContent = `å‰©ä½™æ—¶é—´ï¼š${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (timeRemaining <= 0) {
                clearInterval(timerInterval);
                endGame();
            } else {
                timeRemaining--;
            }
        }

        // å¼€å§‹è®¡æ—¶å™¨
        function startTimer() {
            clearInterval(timerInterval);
            timeRemaining = 5 * 60;
            updateTimer();
            timerInterval = setInterval(updateTimer, 1000);
        }

        // ç»“æŸæ¸¸æˆ
        function endGame() {
            // è®¡ç®—å®Œæˆçš„å›¾å½¢æ•°é‡ï¼ˆç®€å•ä¼°ç®—ï¼‰
            completedShapes = Math.floor(coloredPixels / totalPixels);
            completedShapesElement.textContent = completedShapes;
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            gameOverModal.style.display = 'flex';
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            // é‡ç½®ç”»å¸ƒ
            initCanvasSize();
            
            // é‡ç½®çŠ¶æ€
            selectedColor = '#ffffff';
            isErasing = false;
            coloredPixels = 0;
            completedShapes = 0;
            
            // é‡ç½®UIçŠ¶æ€
            colorButtons.forEach(btn => btn.classList.remove('active'));
            colorButtons[0].classList.add('active');
            eraserButton.classList.remove('active');
            
            // é‡å¯è®¡æ—¶å™¨
            startTimer();
            
            // éšè—æ¨¡æ€æ¡†
            gameOverModal.style.display = 'none';
        }

        // é¢œè‰²é€‰æ‹©äº‹ä»¶
        colorButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                if (isErasing) {
                    isErasing = false;
                    eraserButton.classList.remove('active');
                }
                colorButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedColor = getComputedStyle(btn).backgroundColor;
            });
        });

        // å›¾å½¢é€‰æ‹©äº‹ä»¶
        shapeButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                shapeButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentShape = btn.dataset.shape;
                initCanvasSize();
            });
        });

        // æ©¡çš®æ“¦åŠŸèƒ½äº‹ä»¶
        eraserButton.addEventListener('click', () => {
            isErasing = !isErasing;
            if (isErasing) {
                eraserButton.classList.add('active');
                colorButtons.forEach(b => b.classList.remove('active'));
            } else {
                eraserButton.classList.remove('active');
                colorButtons[0].classList.add('active');
                selectedColor = getComputedStyle(colorButtons[0]).backgroundColor;
            }
        });

        // ç”»ç¬”å¤§å°è°ƒèŠ‚
        brushSizeInput.addEventListener('input', () => {
            brushSize = parseInt(brushSizeInput.value);
        });

        // é‡æ–°å¼€å§‹æŒ‰é’®äº‹ä»¶
        restartButton.addEventListener('click', resetGame);
        modalRestartButton.addEventListener('click', resetGame);

        // ç»˜åˆ¶/æ“¦é™¤å‡½æ•°
        function startDrawing(e) {
            isDrawing = true;
            drawAtPosition(e);
        }

        function stopDrawing() {
            isDrawing = false;
            ctx.beginPath();
        }

        function draw(e) {
            if (!isDrawing) return;
            drawAtPosition(e);
        }

        function drawAtPosition(e) {
            // è·å–ç”»å¸ƒåæ ‡
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - rect.left;
            const y = (e.clientY || e.touches[0].clientY) - rect.top;

            // é€‚é…ç¼©æ”¾
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            const realX = Math.floor(x * scaleX);
            const realY = Math.floor(y * scaleY);

            // ç»˜åˆ¶/æ“¦é™¤
            ctx.fillStyle = isErasing ? '#ffffff' : selectedColor;
            ctx.beginPath();
            ctx.arc(realX, realY, brushSize, 0, Math.PI * 2);
            ctx.fill();

            // ç»Ÿè®¡æ¶‚è‰²åƒç´ ï¼ˆç®€å•ä¼°ç®—ï¼‰
            if (!isErasing && selectedColor !== '#ffffff') {
                coloredPixels += brushSize * brushSize;
            }
        }

        // ç»‘å®šé¼ æ ‡/è§¦æ‘¸äº‹ä»¶
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseleave', stopDrawing);
        canvas.addEventListener('mousemove', draw);

        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            startDrawing(e);
        });
        canvas.addEventListener('touchend', (e) => {
            e.preventDefault();
            stopDrawing();
        });
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            draw(e);
        });

        // åˆå§‹åŒ–
        window.addEventListener('load', () => {
            brushSize = parseInt(brushSizeInput.value);
            initCanvasSize();
            startTimer();
        });
        window.addEventListener('resize', initCanvasSize);
    </script>
</body>
</html>